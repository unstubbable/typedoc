{"version":3,"file":"TocPlugin.js","sourceRoot":"","sources":["../../../../src/lib/output/plugins/TocPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["import { Reflection, ReflectionKind, ProjectReflection, DeclarationReflection } from '../../models/reflections/index';\nimport { Component, RendererComponent } from '../components';\nimport { PageEvent } from '../events';\nimport { NavigationItem } from '../models/NavigationItem';\n\n/**\n * A plugin that generates a table of contents for the current page.\n *\n * The table of contents will start at the nearest module or dynamic module. This plugin\n * sets the [[PageEvent.toc]] property.\n */\n@Component({name: 'toc'})\nexport class TocPlugin extends RendererComponent {\n    /**\n     * Create a new TocPlugin instance.\n     */\n    initialize() {\n        this.listenTo(this.owner, {\n            [PageEvent.BEGIN]: this.onRendererBeginPage\n        });\n    }\n\n    /**\n     * Triggered before a document will be rendered.\n     *\n     * @param page  An event object describing the current render operation.\n     */\n    private onRendererBeginPage(page: PageEvent) {\n        let model = page.model;\n        if (!(model instanceof Reflection)) {\n            return;\n        }\n\n        const trail: Reflection[] = [];\n        while (this.shouldBeIncludedInTrail(model)) {\n            trail.unshift(model);\n            model = model.parent;\n        }\n\n        const tocRestriction = this.owner.toc;\n        const tocIncludeModules = this.owner.tocIncludeModules;\n        page.toc = new NavigationItem();\n        TocPlugin.buildToc(model, trail, page.toc, tocRestriction, tocIncludeModules);\n    }\n\n    private shouldBeIncludedInTrail(model: any): boolean {\n        if (model instanceof ProjectReflection) {\n            return false;\n        }\n\n        return !model.kindOf(ReflectionKind.SomeModule) || this.owner.tocIncludeModules;\n    }\n\n    /**\n     * Create a toc navigation item structure.\n     *\n     * @param model           The models whose children should be written to the toc.\n     * @param trail           Defines the active trail of expanded toc entries.\n     * @param parent          The parent [[NavigationItem]] the toc should be appended to.\n     * @param restriction     The restricted top level toc entries.\n     * @param includeModules  Include modules in the top level toc.\n     */\n    static buildToc(model: Reflection, trail: Reflection[], parent: NavigationItem, restriction?: string[], includeModules?: boolean) {\n        const index = trail.indexOf(model);\n        const children = model['children'] || [];\n\n        if (index < trail.length - 1 && children.length > 40) {\n            const child = trail[index + 1];\n            const item = NavigationItem.create(child, parent, true);\n            item.isInPath  = true;\n            item.isCurrent = false;\n            TocPlugin.buildToc(child, trail, item);\n        } else {\n            children.forEach((child: DeclarationReflection) => {\n\n                if (restriction && restriction.length > 0 && !restriction.includes(child.name)) {\n                    return;\n                }\n\n                if (child.kindOf(ReflectionKind.SomeModule) && !includeModules) {\n                    return;\n                }\n\n                const item = NavigationItem.create(child, parent, true);\n                if (trail.includes(child)) {\n                    item.isInPath  = true;\n                    item.isCurrent = (trail[trail.length - 1] === child);\n                    TocPlugin.buildToc(child, trail, item);\n                }\n            });\n        }\n    }\n}\n"]}